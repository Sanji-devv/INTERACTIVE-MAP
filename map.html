<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <title>DND Interactive Map — Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  
  <style type="text/tailwindcss">
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    :root {
      --sidebar-bg: #1e293b;
      --sidebar-header: #334155;
      --text-main: #e2e8f0;
      --text-muted: #94a3b8;
      --border-color: #475569;
      --input-bg: #0f172a;
      --accent-color: #60a5fa;
      --accent-hover: #3b82f6;
    }
  </style>
  
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#0f1723",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.25rem",
            lg: "0.5rem",
            xl: "0.75rem",
            full: "9999px",
          },
        },
      },
    };
  </script>
  
  <link rel="stylesheet" href="map.css" />
</head>
<body class="bg-background-dark font-display text-white">
  <div class="flex h-screen w-full" id="app">
    <!-- Sidebar -->
    <aside class="flex h-full w-96 flex-col bg-[var(--sidebar-bg)] p-4 shrink-0 text-[var(--text-main)] overflow-y-auto border-r border-[var(--border-color)]">
      <!-- Header -->
      <div class="flex items-center justify-between gap-3 p-3 bg-[var(--sidebar-header)] rounded-lg mb-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500"></div>
          <h1 class="text-lg font-bold">DND MAP</h1>
        </div>
        <button id="themeToggle" class="px-3 py-1.5 text-sm font-medium rounded-md bg-white/10 hover:bg-white/20 transition-colors">
          🌙
        </button>
      </div>

      <!-- Search -->
      <div class="relative mb-4">
        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-muted)] text-sm">search</span>
        <input class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded-lg py-2 pl-10 pr-4 placeholder:text-[var(--text-muted)] focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none text-sm" placeholder="Search markers..." type="text"/>
      </div>

      <!-- Tabs Navigation -->
      <div class="flex gap-1 border-b border-[var(--border-color)] mb-4">
        <button class="tab-btn active flex-1 px-3 py-2 text-xs font-medium border-b-2 border-[var(--accent-color)] text-[var(--accent-color)]" data-tab="editor">Editor</button>
        <button class="tab-btn flex-1 px-3 py-2 text-xs font-medium border-b-2 border-transparent text-[var(--text-muted)] hover:text-[var(--text-main)]" data-tab="filters">Filters</button>
        <button class="tab-btn flex-1 px-3 py-2 text-xs font-medium border-b-2 border-transparent text-[var(--text-muted)] hover:text-[var(--text-main)]" data-tab="players">Players</button>
      </div>

      <!-- Tab Contents -->
      <div class="flex-1 overflow-y-auto">
        <!-- Editor Tab -->
        <div id="editor-tab" class="tab-content active space-y-4">
          <div class="bg-black/20 p-4 rounded-lg">
            <h3 class="font-semibold text-sm mb-3">Create Marker</h3>
            <div class="space-y-3">
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Type:</label>
                <select id="type" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none">
                  <option value="city">City</option>
                  <option value="village">Village</option>
                  <option value="dungeon">Dungeon</option>
                  <option value="resource">Resource</option>
                  <option value="player">Player</option>
                </select>
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Name:</label>
                <input id="name" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Eldoria" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Description:</label>
                <input id="desc" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Short description" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-2">Color:</label>
                <div id="colorSwatches" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
            <button id="placeBtn" class="w-full mt-4 bg-[var(--accent-color)] hover:bg-[var(--accent-hover)] text-white font-medium py-2 rounded-lg transition">
              Create Marker (click map)
            </button>
          </div>

          <div class="bg-black/20 p-4 rounded-lg">
            <p class="text-xs text-[var(--text-muted)]">Map size: <span id="mapSize" class="text-[var(--text-main)] font-mono">—</span></p>
          </div>
        </div>

        <!-- Filters Tab -->
        <div id="filters-tab" class="tab-content space-y-4">
          <div class="bg-black/20 p-4 rounded-lg">
            <h3 class="font-semibold text-sm mb-3">Marker Types</h3>
            <div class="grid grid-cols-2 gap-2">
              <button class="filter-btn active w-full text-center px-2 py-2 text-xs rounded-md bg-[var(--accent-color)]/20 border border-[var(--accent-color)] text-[var(--text-main)] hover:bg-[var(--accent-color)]/30 transition" data-type="city"><div class="text-lg">🏛️</div><div class="text-xs">City</div></button>
              <button class="filter-btn active w-full text-center px-2 py-2 text-xs rounded-md bg-black/30 border border-[var(--border-color)] text-[var(--text-main)] hover:bg-black/50 transition" data-type="village"><div class="text-lg">🏘️</div><div class="text-xs">Village</div></button>
              <button class="filter-btn active w-full text-center px-2 py-2 text-xs rounded-md bg-black/30 border border-[var(--border-color)] text-[var(--text-main)] hover:bg-black/50 transition" data-type="dungeon"><div class="text-lg">⚔️</div><div class="text-xs">Dungeon</div></button>
              <button class="filter-btn active w-full text-center px-2 py-2 text-xs rounded-md bg-black/30 border border-[var(--border-color)] text-[var(--text-main)] hover:bg-black/50 transition" data-type="resource"><div class="text-lg">💎</div><div class="text-xs">Resource</div></button>
              <button class="filter-btn active w-full text-center px-2 py-2 text-xs rounded-md bg-black/30 border border-[var(--border-color)] text-[var(--text-main)] hover:bg-black/50 transition col-span-2" data-type="player"><div class="text-lg">👤</div><div class="text-xs">Player</div></button>
            </div>
          </div>

          <div class="bg-black/20 p-4 rounded-lg">
            <h3 class="font-semibold text-sm mb-3">Actions</h3>
            <div class="space-y-2">
              <button id="exportBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 rounded-lg transition">Export JSON</button>
              <button id="importBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 rounded-lg transition">Import JSON</button>
              <input type="file" id="importFile" accept=".json" style="display:none;" />
              <button id="clearBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded-lg transition">Clear All</button>
              <button id="disableAllBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 rounded-lg transition">Disable All</button>
            </div>
          </div>
        </div>

        <!-- Players Tab -->
        <div id="players-tab" class="tab-content">
          <div class="bg-black/20 p-4 rounded-lg">
            <h3 class="font-semibold text-sm mb-3">Players</h3>
            <div id="playersList" class="space-y-2 mb-4">
              <p class="text-xs text-[var(--text-muted)] text-center py-4">No players yet</p>
            </div>
            <input type="text" id="playerName" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm mb-2 focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Player name" />
            <button id="addPlayerBtn" class="w-full bg-[var(--accent-color)] hover:bg-[var(--accent-hover)] text-white font-medium py-2 rounded-lg transition">
              Add Player
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Map Area -->
    <main class="flex-1 relative bg-black/20" id="main">
      <div id="map" class="absolute inset-0"></div>
    </main>
  </div>

  <!-- Auth Panel (Fixed Bottom Right, Outside App) -->
  <div id="authPanel" class="fixed bottom-4 right-4 w-80 bg-[var(--sidebar-bg)] border border-[var(--border-color)] rounded-lg shadow-2xl z-50 flex flex-col max-h-[500px]">
        <div class="border-b border-[var(--border-color)] p-4 flex-shrink-0 bg-gradient-to-r from-blue-900/40 to-blue-800/20">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-semibold text-[var(--text-main)] flex items-center gap-2">
              <span class="text-lg">🔐</span> Account
            </h3>
            <button id="toggleAuthPanel" class="px-3 py-1 text-xs font-medium bg-red-600 hover:bg-red-700 text-white rounded transition">
              ✕ Hide
            </button>
          </div>
        </div>

        <div class="overflow-y-auto flex-1 p-4" id="authPanelContent">
          <!-- Auth Form -->
          <div id="authForm">
            <div class="flex gap-2 mb-4 border-b border-[var(--border-color)]">
              <button class="auth-tab-btn active flex-1 py-2 text-xs font-medium border-b-2 border-[var(--accent-color)] text-[var(--accent-color)]" data-auth-tab="login">Login</button>
              <button class="auth-tab-btn flex-1 py-2 text-xs font-medium border-b-2 border-transparent text-[var(--text-muted)] hover:text-[var(--text-main)]" data-auth-tab="register">Register</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-tab-content active space-y-3">
              <h3 class="font-semibold text-sm">Login</h3>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Email:</label>
                <input type="email" id="loginEmail" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="your@email.com" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Password:</label>
                <input type="password" id="loginPassword" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Password" />
              </div>
              <button id="loginBtn" class="w-full bg-[var(--accent-color)] hover:bg-[var(--accent-hover)] text-white font-medium py-2 rounded-lg transition">
                Login
              </button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-tab-content space-y-3">
              <h3 class="font-semibold text-sm">Register</h3>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Email:</label>
                <input type="email" id="regEmail" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="your@email.com" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Username:</label>
                <input type="text" id="regUsername" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="display name" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Password:</label>
                <input type="password" id="regPassword" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Password" />
              </div>
              <div>
                <label class="text-xs text-[var(--text-muted)] block mb-1">Confirm:</label>
                <input type="password" id="regConfirm" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Confirm password" />
              </div>
              <p class="text-xs text-[var(--text-muted)]">All users register as USER type</p>
              <button id="registerBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 rounded-lg transition">
                Register
              </button>
            </div>
          </div>

          <!-- User Info (shown after login) -->
          <div id="userInfo" style="display:none;" class="space-y-4">
            <div class="bg-black/30 p-3 rounded-lg">
              <p class="text-xs text-[var(--text-muted)] mb-2">Logged in as:</p>
              <p id="currentUser" class="text-sm font-semibold text-[var(--accent-color)]">—</p>
              <p id="userType" class="text-xs text-[var(--text-muted)] mt-1">Type: USER</p>
            </div>

            <!-- Profile Section -->
            <div class="bg-black/30 p-3 rounded-lg">
              <h4 class="font-semibold text-sm mb-3">Profile</h4>
              <div class="space-y-2">
                <div>
                  <label class="text-xs text-[var(--text-muted)] block mb-1">Display name:</label>
                  <input type="text" id="profileUsername" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Display name" />
                </div>
                <div>
                  <label class="text-xs text-[var(--text-muted)] block mb-1">Nickname:</label>
                  <input type="text" id="profileNickname" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="In-game nickname" />
                </div>
                <button id="updateProfileBtn" class="w-full bg-[var(--accent-color)] hover:bg-[var(--accent-hover)] text-white font-medium py-2 rounded-lg transition text-sm">
                  Update Profile
                </button>
              </div>
            </div>

            <!-- Characters Section -->
            <div class="bg-black/30 p-3 rounded-lg">
              <h4 class="font-semibold text-sm mb-3">Characters</h4>
              <div class="space-y-2 mb-3">
                <div>
                  <label class="text-xs text-[var(--text-muted)] block mb-1">Name:</label>
                  <input type="text" id="charName" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Character name" />
                </div>
                <div>
                  <label class="text-xs text-[var(--text-muted)] block mb-1">Class:</label>
                  <input type="text" id="charClass" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="Class (e.g. Fighter)" />
                </div>
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="text-xs text-[var(--text-muted)] block mb-1">X:</label>
                    <input type="number" id="charX" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="x" />
                  </div>
                  <div>
                    <label class="text-xs text-[var(--text-muted)] block mb-1">Y:</label>
                    <input type="number" id="charY" class="w-full bg-[var(--input-bg)] border border-[var(--border-color)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none" placeholder="y" />
                  </div>
                </div>
                <button id="createCharBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 rounded-lg transition text-sm">
                  Create Character
                </button>
              </div>
              <div id="charactersList" class="space-y-2 max-h-48 overflow-y-auto">
                <p class="text-xs text-[var(--text-muted)] text-center py-3">No characters yet</p>
              </div>
            </div>

            <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded-lg transition">
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>

  <script src="data/user_database.js"></script>
  <script src="data/database.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="map.js"></script>
</body>
</html>